Задача 17.1: Алгоритм для нахождения всех правильных скобочных последовательностей с использованием n пар скобок

using System;
using System.Collections.Generic;

public class ParenthesesGenerator
{
    public IList<string> GenerateParenthesis(int n)
    {
        if (n < 0) throw new ArgumentException("n должно быть неотрицательным.");

        List<string> result = new List<string>();
        Backtrack(result, "", 0, 0, n);
        return result;
    }

    private void Backtrack(List<string> result, string current, int open, int close, int max)
    {
        if (current.Length == max * 2)
        {
            result.Add(current);
            return;
        }

        if (open < max)
        {
            Backtrack(result, current + "(", open + 1, close, max);
        }

        if (close < open)
        {
            Backtrack(result, current + ")", open, close + 1, max);
        }
    }
}

class Program
{
    static void Main()
    {
        ParenthesesGenerator gen = new ParenthesesGenerator();
        var parentheses = gen.GenerateParenthesis(3);
        Console.WriteLine("Правильные скобочные последовательности:");
        foreach (var p in parentheses)
        {
            Console.WriteLine(p);
        }
    }
}






Задача 17.2: Программа для поворота матрицы на 90 градусов по часовой стрелке на месте
using System;

public class MatrixRotator
{
    public void Rotate(int[][] matrix)
    {
        if (matrix == null || matrix.Length == 0) return;

        int n = matrix.Length;
        for (int i = 0; i < n; i++)
        {
            if (matrix[i].Length != n) throw new ArgumentException("Матрица должна быть квадратной.");
        }

        for (int i = 0; i < n; i++)
        {
            for (int j = i + 1; j < n; j++)
            {
                int temp = matrix[i][j];
                matrix[i][j] = matrix[j][i];
                matrix[j][i] = temp;
            }
        }

        for (int i = 0; i < n; i++)
        {
            Array.Reverse(matrix[i]);
        }
    }
}

class Program
{
    static void Main()
    {
        int[][] matrix = new int[][]
        {
            new int[] {1, 2, 3},
            new int[] {4, 5, 6},
            new int[] {7, 8, 9}
        };

        MatrixRotator rotator = new MatrixRotator();
        rotator.Rotate(matrix);

        Console.WriteLine("Повёрнутая матрица:");
        for (int i = 0; i < matrix.Length; i++)
        {
            Console.WriteLine(string.Join(" ", matrix[i]));
        }
    }
}









Задача 17.3: Класс LinkedList для одиночно связного списка
using System;
using System.Text;

public class Node
{
    public int Value { get; set; }
    public Node Next { get; set; }

    public Node(int value)
    {
        Value = value;
        Next = null;
    }
}

public class LinkedList
{
    private Node head;

    public void Insert(int value)
    {
        Node newNode = new Node(value);
        if (head == null)
        {
            head = newNode;
        }
        else
        {
            Node current = head;
            while (current.Next != null)
            {
                current = current.Next;
            }
            current.Next = newNode;
        }
    }

    public void Delete(int value)
    {
        if (head == null) return;

        if (head.Value == value)
        {
            head = head.Next;
            return;
        }

        Node current = head;
        while (current.Next != null)
        {
            if (current.Next.Value == value)
            {
                current.Next = current.Next.Next;
                return;
            }
            current = current.Next;
        }
    }

    public bool Search(int value)
    {
        Node current = head;
        while (current != null)
        {
            if (current.Value == value) return true;
            current = current.Next;
        }
        return false;
    }

    public void Reverse()
    {
        Node prev = null;
        Node current = head;
        while (current != null)
        {
            Node next = current.Next;
            current.Next = prev;
            prev = current;
            current = next;
        }
        head = prev;
    }

    public override string ToString()
    {
        StringBuilder sb = new StringBuilder();
        Node current = head;
        while (current != null)
        {
            sb.Append(current.Value).Append(" -> ");
            current = current.Next;
        }
        return sb.Length > 0 ? sb.ToString(0, sb.Length - 4) : "";
    }
}

class Program
{
    static void Main()
    {
        LinkedList ll = new LinkedList();
        ll.Insert(1);
        ll.Insert(2);
        ll.Insert(3);
        Console.WriteLine(ll);

        ll.Reverse();
        Console.WriteLine(ll);

        ll.Delete(2);
        Console.WriteLine(ll);

        Console.WriteLine(ll.Search(1));
        Console.WriteLine(ll.Search(4));
    }
}








Задача 17.4: Алгоритм для нахождения LCS двух строк методом динамического программирования
using System;
using System.Text;

public class LCSFinder
{
    public (int, string) LongestCommonSubsequence(string s1, string s2)
    {
        int m = s1.Length;
        int n = s2.Length;
        int[,] dp = new int[m + 1, n + 1];

        for (int i = 1; i <= m; i++)
        {
            for (int j = 1; j <= n; j++)
            {
                if (s1[i - 1] == s2[j - 1])
                {
                    dp[i, j] = dp[i - 1, j - 1] + 1;
                }
                else
                {
                    dp[i, j] = Math.Max(dp[i - 1, j], dp[i, j - 1]);
                }
            }
        }

        StringBuilder lcs = new StringBuilder();
        int ii = m, jj = n;
        while (ii > 0 && jj > 0)
        {
            if (s1[ii - 1] == s2[jj - 1])
            {
                lcs.Insert(0, s1[ii - 1]);
                ii--;
                jj--;
            }
            else if (dp[ii - 1, jj] > dp[ii, jj - 1])
            {
                ii--;
            }
            else
            {
                jj--;
            }
        }

        return (dp[m, n], lcs.ToString());
    }
}

class Program
{
    static void Main()
    {
        LCSFinder finder = new LCSFinder();
        var (length, subsequence) = finder.LongestCommonSubsequence("ABCBDAB", "BDCAB");
        Console.WriteLine($"Длина LCS: {length}, Подпоследовательность: {subsequence}");
    }
}









Задача 17.5: Программа для системы инвентаризации
using System;
using System.Collections.Generic;
using System.Text;

public class InventorySystem
{
    private Dictionary<string, (int Quantity, double Price)> inventory = new Dictionary<string, (int, double)>();

    public void AddItem(string name, int quantity, double price)
    {
        if (quantity < 0) throw new ArgumentException("Количество не может быть отрицательным.");

        if (inventory.ContainsKey(name))
        {
            var (q, p) = inventory[name];
            inventory[name] = (q + quantity, p);
        }
        else
        {
            inventory[name] = (quantity, price);
        }
    }

    public void RemoveItem(string name, int quantity)
    {
        if (!inventory.ContainsKey(name))
        {
            Console.WriteLine($"Товар {name} не найден.");
            return;
        }

        var (q, p) = inventory[name];
        if (q < quantity)
        {
            Console.WriteLine($"Недостаточно {name} на складе.");
            return;
        }

        inventory[name] = (q - quantity, p);
        if (inventory[name].Quantity == 0)
        {
            inventory.Remove(name);
        }
    }

    public string CheckDiscrepancy(string name, int expectedQuantity)
    {
        if (!inventory.ContainsKey(name)) return "Товар не найден";

        int actual = inventory[name].Quantity;
        if (actual > expectedQuantity) return $"Перелёт: +{actual - expectedQuantity}";
        if (actual < expectedQuantity) return $"Недолёт: -{expectedQuantity - actual}";
        return "Соответствует";
    }

    public string GenerateReport()
    {
        StringBuilder report = new StringBuilder("Отчёт по складу:\n");
        double totalValue = 0;

        foreach (var kvp in inventory)
        {
            string name = kvp.Key;
            var (q, p) = kvp.Value;
            double value = q * p;
            report.AppendLine($"{name}: {q} шт., цена {p}, стоимость {value}");
            totalValue += value;
        }

        report.AppendLine($"Общая стоимость: {totalValue}");
        return report.ToString();
    }
}

class Program
{
    static void Main()
    {
        InventorySystem inv = new InventorySystem();
        inv.AddItem("Яблоки", 100, 1.5);
        inv.AddItem("Бананы", 50, 2.0);
        inv.RemoveItem("Яблоки", 20);
        Console.WriteLine(inv.CheckDiscrepancy("Яблоки", 80));
        Console.WriteLine(inv.GenerateReport());
    }
}






17. Приложение для управления музеем

using System;
using System.Collections.Generic;
using System.Linq;
using Microsoft.EntityFrameworkCore;

namespace MuseumManagementSystem
{
    public class Exhibit
    {
        public int Id { get; set; }
        public string Name { get; set; }
        public string Description { get; set; }
        public string PhotoPath { get; set; }
        public string Category { get; set; }
        public int Year { get; set; }
        public string Origin { get; set; }
        public bool IsOnDisplay { get; set; }

        public virtual ICollection<Exhibition> Exhibitions { get; set; } = new List<Exhibition>();
    }

    public class Exhibition
    {
        public int Id { get; set; }
        public string Name { get; set; }
        public string Description { get; set; }
        public DateTime StartDate { get; set; }
        public DateTime EndDate { get; set; }
        public string Curator { get; set; }

        public virtual ICollection<Exhibit> Exhibits { get; set; } = new List<Exhibit>();
        public virtual ICollection<Tour> Tours { get; set; } = new List<Tour>();
    }

    public class Guide : Employee
    {
        public string Specialization { get; set; }

        public virtual ICollection<Tour> Tours { get; set; } = new List<Tour>();
    }

    public class Tour
    {
        public int Id { get; set; }
        public DateTime DateTime { get; set; }
        public int GuideId { get; set; }
        public Guide Guide { get; set; }
        public int ExhibitionId { get; set; }
        public Exhibition Exhibition { get; set; }
        public int MaxParticipants { get; set; }
        public decimal Price { get; set; }
        public int DurationMinutes { get; set; }

        public virtual ICollection<Visitor> Participants { get; set; } = new List<Visitor>();
    }

    public class Ticket
    {
        public int Id { get; set; }
        public DateTime Date { get; set; }
        public decimal Price { get; set; }
        public string Type { get; set; }
        public int? TourId { get; set; }
        public Tour Tour { get; set; }
        public int VisitorId { get; set; }
        public Visitor Visitor { get; set; }
    }

    public class Souvenir
    {
        public int Id { get; set; }
        public string Name { get; set; }
        public string Description { get; set; }
        public decimal Price { get; set; }
        public int Stock { get; set; }
        public string Category { get; set; }

        public virtual ICollection<SouvenirSale> Sales { get; set; } = new List<SouvenirSale>();
    }

    public class SouvenirSale
    {
        public int Id { get; set; }
        public int SouvenirId { get; set; }
        public Souvenir Souvenir { get; set; }
        public int Quantity { get; set; }
        public DateTime SaleDate { get; set; }
        public decimal TotalPrice { get; set; }
        public int VisitorId { get; set; }
        public Visitor Visitor { get; set; }
    }

    public class Employee
    {
        public int Id { get; set; }
        public string Name { get; set; }
        public string Position { get; set; }
        public DateTime HireDate { get; set; }
        public decimal Salary { get; set; }
        public string ContactEmail { get; set; }
    }

    public class Visitor
    {
        public int Id { get; set; }
        public string Name { get; set; }
        public string Email { get; set; }
        public string Phone { get; set; }
        public DateTime RegistrationDate { get; set; }

        public virtual ICollection<Tour> Tours { get; set; } = new List<Tour>();
        public virtual ICollection<Ticket> Tickets { get; set; } = new List<Ticket>();
        public virtual ICollection<SouvenirSale> SouvenirSales { get; set; } = new List<SouvenirSale>();
    }

    public class MuseumDbContext : DbContext
    {
        public DbSet<Exhibit> Exhibits { get; set; }
        public DbSet<Exhibition> Exhibitions { get; set; }
        public DbSet<Tour> Tours { get; set; }
        public DbSet<Guide> Guides { get; set; }
        public DbSet<Ticket> Tickets { get; set; }
        public DbSet<Souvenir> Souvenirs { get; set; }
        public DbSet<Employee> Employees { get; set; }
        public DbSet<Visitor> Visitors { get; set; }
        public DbSet<SouvenirSale> SouvenirSales { get; set; }

        protected override void OnConfiguring(DbContextOptionsBuilder optionsBuilder)
        {
            optionsBuilder.UseSqlite("Data Source=museum.db");
        }

        protected override void OnModelCreating(ModelBuilder modelBuilder)
        {
            modelBuilder.Entity<Exhibit>()
                .HasMany(e => e.Exhibitions)
                .WithMany(ex => ex.Exhibits);

            modelBuilder.Entity<Tour>()
                .HasMany(t => t.Participants)
                .WithMany(v => v.Tours);

            modelBuilder.Entity<Ticket>()
                .HasOne(t => t.Tour)
                .WithMany()
                .HasForeignKey(t => t.TourId);

            modelBuilder.Entity<Ticket>()
                .HasOne(t => t.Visitor)
                .WithMany(v => v.Tickets)
                .HasForeignKey(t => t.VisitorId);

            modelBuilder.Entity<SouvenirSale>()
                .HasOne(s => s.Souvenir)
                .WithMany(sv => sv.Sales)
                .HasForeignKey(s => s.SouvenirId);

            modelBuilder.Entity<SouvenirSale>()
                .HasOne(s => s.Visitor)
                .WithMany(v => v.SouvenirSales)
                .HasForeignKey(s => s.VisitorId);

            modelBuilder.Entity<Guide>().ToTable("Guides");

            modelBuilder.Entity<Exhibit>()
                .HasIndex(e => e.Name)
                .IsUnique();

            modelBuilder.Entity<Exhibition>()
                .HasIndex(ex => ex.Name)
                .IsUnique();

            modelBuilder.Entity<Employee>()
                .HasIndex(emp => emp.ContactEmail)
                .IsUnique();
        }
    }

    public class Museum
    {
        private readonly MuseumDbContext _context;

        public Museum(MuseumDbContext context)
        {
            _context = context;
        }

        public void AddExhibit(Exhibit exhibit)
        {
            _context.Exhibits.Add(exhibit);
            _context.SaveChanges();
        }

        public Exhibit GetExhibit(int id)
        {
            return _context.Exhibits.Find(id);
        }

        public void UpdateExhibit(Exhibit exhibit)
        {
            _context.Exhibits.Update(exhibit);
            _context.SaveChanges();
        }

        public void DeleteExhibit(int id)
        {
            var exhibit = _context.Exhibits.Find(id);
            if (exhibit != null)
            {
                _context.Exhibits.Remove(exhibit);
                _context.SaveChanges();
            }
        }

        public void AddExhibition(Exhibition exhibition)
        {
            _context.Exhibitions.Add(exhibition);
            _context.SaveChanges();
        }

        public Exhibition GetExhibition(int id)
        {
            return _context.Exhibitions.Include(e => e.Exhibits).Include(e => e.Tours).FirstOrDefault(e => e.Id == id);
        }

        public void AddExhibitToExhibition(int exhibitionId, int exhibitId)
        {
            var exhibition = _context.Exhibitions.Include(e => e.Exhibits).FirstOrDefault(e => e.Id == exhibitionId);
            var exhibit = _context.Exhibits.FirstOrDefault(e => e.Id == exhibitId);
            if (exhibition != null && exhibit != null)
            {
                exhibition.Exhibits.Add(exhibit);
                _context.SaveChanges();
            }
        }

        public void AddTour(Tour tour)
        {
            _context.Tours.Add(tour);
            _context.SaveChanges();
        }

        public Tour GetTour(int id)
        {
            return _context.Tours
                .Include(t => t.Guide)
                .Include(t => t.Exhibition)
                .Include(t => t.Participants)
                .FirstOrDefault(t => t.Id == id);
        }

        public bool AddParticipantToTour(int tourId, int visitorId)
        {
            var tour = _context.Tours.Include(t => t.Participants).FirstOrDefault(t => t.Id == tourId);
            var visitor = _context.Visitors.FirstOrDefault(v => v.Id == visitorId);
            if (tour != null && visitor != null && tour.Participants.Count < tour.MaxParticipants)
            {
                tour.Participants.Add(visitor);
                _context.SaveChanges();
                return true;
            }
            return false;
        }

        public void AddGuide(Guide guide)
        {
            _context.Guides.Add(guide);
            _context.SaveChanges();
        }

        public Guide GetGuide(int id)
        {
            return _context.Guides.Include(g => g.Tours).FirstOrDefault(g => g.Id == id);
        }

        public void SellTicket(Ticket ticket)
        {
            _context.Tickets.Add(ticket);
            _context.SaveChanges();
        }

        public List<Ticket> GetTicketsByDate(DateTime date)
        {
            return _context.Tickets.Where(t => t.Date.Date == date.Date).ToList();
        }

        public void AddSouvenir(Souvenir souvenir)
        {
            _context.Souvenirs.Add(souvenir);
            _context.SaveChanges();
        }

        public Souvenir GetSouvenir(int id)
        {
            return _context.Souvenirs.Find(id);
        }

        public bool SellSouvenir(int souvenirId, int quantity, int visitorId)
        {
            var souvenir = _context.Souvenirs.FirstOrDefault(s => s.Id == souvenirId);
            var visitor = _context.Visitors.FirstOrDefault(v => v.Id == visitorId);
            if (souvenir != null && visitor != null && souvenir.Stock >= quantity)
            {
                souvenir.Stock -= quantity;
                var sale = new SouvenirSale
                {
                    SouvenirId = souvenirId,
                    Quantity = quantity,
                    SaleDate = DateTime.Now,
                    TotalPrice = quantity * souvenir.Price,
                    VisitorId = visitorId
                };
                _context.SouvenirSales.Add(sale);
                _context.SaveChanges();
                return true;
            }
            return false;
        }

        public void AddEmployee(Employee employee)
        {
            _context.Employees.Add(employee);
            _context.SaveChanges();
        }

        public Employee GetEmployee(int id)
        {
            return _context.Employees.Find(id);
        }

        public void AddVisitor(Visitor visitor)
        {
            _context.Visitors.Add(visitor);
            _context.SaveChanges();
        }

        public Visitor GetVisitor(int id)
        {
            return _context.Visitors
                .Include(v => v.Tours)
                .Include(v => v.Tickets)
                .Include(v => v.SouvenirSales)
                .FirstOrDefault(v => v.Id == id);
        }

        public Dictionary<DateTime, int> GenerateAttendanceReport(DateTime start, DateTime end)
        {
            var dailyTickets = _context.Tickets
                .Where(t => t.Date >= start && t.Date <= end)
                .GroupBy(t => t.Date.Date)
                .ToDictionary(g => g.Key, g => g.Count());

            var report = new Dictionary<DateTime, int>();
            for (var date = start.Date; date <= end.Date; date = date.AddDays(1))
            {
                report[date] = dailyTickets.ContainsKey(date) ? dailyTickets[date] : 0;
            }

            return report;
        }

        public decimal GenerateTicketRevenueReport(DateTime start, DateTime end)
        {
            return _context.Tickets
                .Where(t => t.Date >= start && t.Date <= end)
                .Sum(t => t.Price);
        }

        public decimal GenerateSouvenirRevenueReport(DateTime start, DateTime end)
        {
            return _context.SouvenirSales
                .Where(s => s.SaleDate >= start && s.SaleDate <= end)
                .Sum(s => s.TotalPrice);
        }

        public List<Exhibit> GetPopularExhibits(int topN)
        {
            return _context.Exhibits
                .OrderByDescending(e => e.Exhibitions.SelectMany(ex => ex.Tours).SelectMany(t => t.Participants).Count())
                .Take(topN)
                .ToList();
        }
    }

    class Program
    {
        static void Main(string[] args)
        {
            using var context = new MuseumDbContext();
            context.Database.EnsureCreated();

            Museum museum = new Museum(context);

            var visitor1 = new Visitor { Id = 1, Name = "Visitor1", Email = "visitor1@example.com", Phone = "123-456-7890", RegistrationDate = DateTime.Now };
            museum.AddVisitor(visitor1);

            var exhibit1 = new Exhibit { Id = 1, Name = "Ancient Vase", Description = "A vase from ancient Greece", PhotoPath = "path/to/vase.jpg", Category = "Artifacts", Year = 500, Origin = "Greece", IsOnDisplay = true };
            museum.AddExhibit(exhibit1);

            var exhibition1 = new Exhibition { Id = 1, Name = "Ancient Artifacts", Description = "Collection of ancient items", StartDate = DateTime.Now, EndDate = DateTime.Now.AddMonths(1), Curator = "Dr. History" };
            museum.AddExhibition(exhibition1);
            museum.AddExhibitToExhibition(1, 1);

            var guide1 = new Guide { Id = 1, Name = "John Doe", Position = "Guide", HireDate = DateTime.Now.AddYears(-5), Salary = 50000, ContactEmail = "john@example.com", Specialization = "Ancient History" };
            museum.AddGuide(guide1);

            var tour1 = new Tour { Id = 1, DateTime = DateTime.Now.AddDays(1), GuideId = 1, ExhibitionId = 1, MaxParticipants = 20, Price = 15.00m, DurationMinutes = 60 };
            museum.AddTour(tour1);
            museum.AddParticipantToTour(1, 1);

            var ticket1 = new Ticket { Id = 1, Date = DateTime.Now, Price = 10.00m, Type = "Adult", TourId = 1, VisitorId = 1 };
            museum.SellTicket(ticket1);

            var souvenir1 = new Souvenir { Id = 1, Name = "Museum Mug", Description = "Ceramic mug with museum logo", Price = 5.00m, Stock = 100, Category = "Merchandise" };
            museum.AddSouvenir(souvenir1);
            museum.SellSouvenir(1, 1, 1);

            var employee1 = new Employee { Id = 2, Name = "Jane Smith", Position = "Manager", HireDate = DateTime.Now.AddYears(-10), Salary = 80000, ContactEmail = "jane@example.com" };
            museum.AddEmployee(employee1);

            var attendanceReport = museum.GenerateAttendanceReport(DateTime.Now.AddDays(-7), DateTime.Now);
            foreach (var entry in attendanceReport)
            {
                Console.WriteLine($"{entry.Key:yyyy-MM-dd}: {entry.Value} visitors");
            }

            var ticketRevenue = museum.GenerateTicketRevenueReport(DateTime.Now.AddDays(-7), DateTime.Now);
            Console.WriteLine($"Ticket Revenue: {ticketRevenue:C}");

            var souvenirRevenue = museum.GenerateSouvenirRevenueReport(DateTime.Now.AddDays(-7), DateTime.Now);
            Console.WriteLine($"Souvenir Revenue: {souvenirRevenue:C}");

            var popularExhibits = museum.GetPopularExhibits(5);
            Console.WriteLine("Popular Exhibits:");
            foreach (var exhibit in popularExhibits)
            {
                Console.WriteLine(exhibit.Name);
            }
        }
    }
}
